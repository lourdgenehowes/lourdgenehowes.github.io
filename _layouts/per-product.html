<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="{{ site.description }}">
    <meta name="author" content="">
    <title>{{ site.title}} </title>
    <link rel="shorcut icon" href="/favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/per-product.css">
</head>
<body>

{% include navbar.html %}
<div id="product-content">
    {% include per-product/product-content.html %}
</div>
{% include footer.html %}

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/jquery.mobile.min.js"></script>
<script type="text/javascript" src="/js/modernizr.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript">
    //Product Slider
    jQuery(document).ready(function ($) {
        var galleryItems = $('.cd-gallery').children('li');

        galleryItems.each(function () {
            var container = $(this),
            // create slider dots
                    sliderDots = createSliderDots(container);
            //check if item is on sale
            updatePrice(container, 0);

            // update slider when user clicks one of the dots
            sliderDots.on('click', function () {
                var selectedDot = $(this);
                if (!selectedDot.hasClass('selected')) {
                    var selectedPosition = selectedDot.index(),
                            activePosition = container.find('.cd-item-wrapper .selected').index();
                    if (activePosition < selectedPosition) {
                        nextSlide(container, sliderDots, selectedPosition);
                    } else {
                        prevSlide(container, sliderDots, selectedPosition);
                    }

                    updatePrice(container, selectedPosition);
                }
            });

            // update slider on swipeleft
            container.find('.cd-item-wrapper').on('swipeleft', function () {
                var wrapper = $(this);
                if (!wrapper.find('.selected').is(':last-child')) {
                    var selectedPosition = container.find('.cd-item-wrapper .selected').index() + 1;
                    nextSlide(container, sliderDots);
                    updatePrice(container, selectedPosition);
                }
            });

            // update slider on swiperight
            container.find('.cd-item-wrapper').on('swiperight', function () {
                var wrapper = $(this);
                if (!wrapper.find('.selected').is(':first-child')) {
                    var selectedPosition = container.find('.cd-item-wrapper .selected').index() - 1;
                    prevSlide(container, sliderDots);
                    updatePrice(container, selectedPosition);
                }
            });

            // preview image hover effect - desktop only
            container.on('mouseover', '.move-right, .move-left', function (event) {
                hoverItem($(this), true);
            });
            container.on('mouseleave', '.move-right, .move-left', function (event) {
                hoverItem($(this), false);
            });

            // update slider when user clicks on the preview images
            container.on('click', '.move-right, .move-left', function (event) {
                event.preventDefault();
                if ($(this).hasClass('move-right')) {
                    var selectedPosition = container.find('.cd-item-wrapper .selected').index() + 1;
                    nextSlide(container, sliderDots);
                } else {
                    var selectedPosition = container.find('.cd-item-wrapper .selected').index() - 1;
                    prevSlide(container, sliderDots);
                }
                updatePrice(container, selectedPosition);
            });
        });

        function createSliderDots(container) {
            var dotsWrapper = $('<ol class="cd-dots"></ol>').insertAfter(container.children('a'));
            container.find('.cd-item-wrapper li').each(function (index) {
                var dotWrapper = (index == 0) ? $('<li class="selected"></li>') : $('<li></li>'),
                        dot = $('<a href="#0"></a>').appendTo(dotWrapper);
                dotWrapper.appendTo(dotsWrapper);
                dot.text(index + 1);
            });
            return dotsWrapper.children('li');
        }

        function hoverItem(item, bool) {
            ( item.hasClass('move-right') )
                    ? item.toggleClass('hover', bool).siblings('.selected, .move-left').toggleClass('focus-on-right', bool)
                    : item.toggleClass('hover', bool).siblings('.selected, .move-right').toggleClass('focus-on-left', bool);
        }

        function nextSlide(container, dots, n) {
            var visibleSlide = container.find('.cd-item-wrapper .selected'),
                    navigationDot = container.find('.cd-dots .selected');
            if (typeof n === 'undefined') n = visibleSlide.index() + 1;
            visibleSlide.removeClass('selected');
            container.find('.cd-item-wrapper li').eq(n).addClass('selected').removeClass('move-right hover').prevAll().removeClass('move-right move-left focus-on-right').addClass('hide-left').end().prev().removeClass('hide-left').addClass('move-left').end().next().addClass('move-right');
            navigationDot.removeClass('selected')
            dots.eq(n).addClass('selected');
        }

        function prevSlide(container, dots, n) {
            var visibleSlide = container.find('.cd-item-wrapper .selected'),
                    navigationDot = container.find('.cd-dots .selected');
            if (typeof n === 'undefined') n = visibleSlide.index() - 1;
            visibleSlide.removeClass('selected focus-on-left');
            container.find('.cd-item-wrapper li').eq(n).addClass('selected').removeClass('move-left hide-left hover').nextAll().removeClass('hide-left move-right move-left focus-on-left').end().next().addClass('move-right').end().prev().removeClass('hide-left').addClass('move-left');
            navigationDot.removeClass('selected');
            dots.eq(n).addClass('selected');
        }

        function updatePrice(container, n) {
            var priceTag = container.find('.cd-price'),
                    selectedItem = container.find('.cd-item-wrapper li').eq(n);
            if (selectedItem.data('sale')) {
                // if item is on sale - cross old price and add new one
                priceTag.addClass('on-sale');
                var newPriceTag = ( priceTag.next('.cd-new-price').length > 0 ) ? priceTag.next('.cd-new-price') : $('<em class="cd-new-price"></em>').insertAfter(priceTag);
                newPriceTag.text(selectedItem.data('price'));
                setTimeout(function () {
                    newPriceTag.addClass('is-visible');
                }, 100);
            } else {
                // if item is not on sale - remove cross on old price and sale price
                priceTag.removeClass('on-sale').next('.cd-new-price').removeClass('is-visible').on('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                    priceTag.next('.cd-new-price').remove();
                });
            }
        }
    });

    //Navbar menu animation
    $(document).ready(function ($) {
        function morphDropdown(element) {
            this.element = element;
            this.mainNavigation = this.element.find('.main-nav');
            this.mainNavigationItems = this.mainNavigation.find('.has-dropdown');
            this.dropdownList = this.element.find('.dropdown-list');
            this.dropdownWrappers = this.dropdownList.find('.dropdown');
            this.dropdownItems = this.dropdownList.find('.content');
            this.dropdownBg = this.dropdownList.find('.bg-layer');
            this.mq = this.checkMq();
            this.bindEvents();
        }

        morphDropdown.prototype.checkMq = function () {
            //check screen size
            var self = this;
            return window.getComputedStyle(self.element.get(0), '::before').getPropertyValue('content').replace(/'/g, "").replace(/"/g, "").split(', ');
        };

        morphDropdown.prototype.bindEvents = function () {
            var self = this;
            //hover over an item in the main navigation
            this.mainNavigationItems.mouseenter(function (event) {
                //hover over one of the nav items -> show dropdown
                self.showDropdown($(this));
            }).mouseleave(function () {
                setTimeout(function () {
                    //if not hovering over a nav item or a dropdown -> hide dropdown
                    if (self.mainNavigation.find('.has-dropdown:hover').length == 0 && self.element.find('.dropdown-list:hover').length == 0) self.hideDropdown();
                }, 50);
            });

            //hover over the dropdown
            this.dropdownList.mouseleave(function () {
                setTimeout(function () {
                    //if not hovering over a dropdown or a nav item -> hide dropdown
                    (self.mainNavigation.find('.has-dropdown:hover').length == 0 && self.element.find('.dropdown-list:hover').length == 0 ) && self.hideDropdown();
                }, 50);
            });

            //click on an item in the main navigation -> open a dropdown on a touch device
            this.mainNavigationItems.on('touchstart', function (event) {
                var selectedDropdown = self.dropdownList.find('#' + $(this).data('content'));
                if (!self.element.hasClass('is-dropdown-visible') || !selectedDropdown.hasClass('active')) {
                    event.preventDefault();
                    self.showDropdown($(this));
                }
            });

            //on small screens, open navigation clicking on the menu icon
            this.element.on('click', '.nav-trigger', function (event) {
                event.preventDefault();
                self.element.toggleClass('nav-open');
            });
        };

        morphDropdown.prototype.showDropdown = function (item) {
            this.mq = this.checkMq();
            if (this.mq == 'desktop') {
                var self = this;
                var selectedDropdown = this.dropdownList.find('#' + item.data('content')),
                        selectedDropdownHeight = selectedDropdown.innerHeight(),
                        selectedDropdownWidth = selectedDropdown.children('.content').innerWidth(),
                        selectedDropdownLeft = item.offset().left + item.innerWidth() / 2 - selectedDropdownWidth / 2;

                //update dropdown position and size
                this.updateDropdown(selectedDropdown, parseInt(selectedDropdownHeight), selectedDropdownWidth, parseInt(selectedDropdownLeft));
                //add active class to the proper dropdown item
                this.element.find('.active').removeClass('active');
                selectedDropdown.addClass('active').removeClass('move-left move-right').prevAll().addClass('move-left').end().nextAll().addClass('move-right');
                item.addClass('active');
                //show the dropdown wrapper if not visible yet
                if (!this.element.hasClass('is-dropdown-visible')) {
                    setTimeout(function () {
                        self.element.addClass('is-dropdown-visible');
                    }, 10);
                }
            }
        };

        morphDropdown.prototype.updateDropdown = function (dropdownItem, height, width, left) {
            this.dropdownList.css({
                '-moz-transform': 'translateX(' + left + 'px)',
                '-webkit-transform': 'translateX(' + left + 'px)',
                '-ms-transform': 'translateX(' + left + 'px)',
                '-o-transform': 'translateX(' + left + 'px)',
                'transform': 'translateX(' + left + 'px)',
                'width': width + 'px',
                'height': height + 'px'
            });

            this.dropdownBg.css({
                '-moz-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                '-webkit-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                '-ms-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                '-o-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                'transform': 'scaleX(' + width + ') scaleY(' + height + ')'
            });
        };

        morphDropdown.prototype.hideDropdown = function () {
            this.mq = this.checkMq();
            if (this.mq == 'desktop') {
                this.element.removeClass('is-dropdown-visible').find('.active').removeClass('active').end().find('.move-left').removeClass('move-left').end().find('.move-right').removeClass('move-right');
            }
        };

        morphDropdown.prototype.resetDropdown = function () {
            this.mq = this.checkMq();
            if (this.mq == 'mobile') {
                this.dropdownList.removeAttr('style');
            }
        };

        var morphDropdowns = [];
        if ($('.cd-morph-dropdown').length > 0) {
            $('.cd-morph-dropdown').each(function () {
                //create a morphDropdown object for each .cd-morph-dropdown
                morphDropdowns.push(new morphDropdown($(this)));
            });

            var resizing = false;

            //on resize, reset dropdown style property
            updateDropdownPosition();
            $(window).on('resize', function () {
                if (!resizing) {
                    resizing = true;
                    (!window.requestAnimationFrame) ? setTimeout(updateDropdownPosition, 300) : window.requestAnimationFrame(updateDropdownPosition);
                }
            });

            function updateDropdownPosition() {
                morphDropdowns.forEach(function (element) {
                    element.resetDropdown();
                });

                resizing = false;
            };
        }
    });
</script>
</body>

</html>
